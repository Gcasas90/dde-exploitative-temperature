# Temperature effects on ontogenesis and consequences for species coexistence in thermally variable environments

## Introduction

This project contains the code and other analysis elements used for the analysis of my second dissertation chapter and is shared here for reproducibility purposes.  In this study we look into how a variable thermal environment interacts with population stage structure to produce community level outcomes.  We focus on an exploitative competition food web module, with two consumer species both attacking the same resource species.  Our analysis uses delay differential equations (DDEs) framework in order to capture the developmental delays induced by stage structure and maturation \cite{Nisbet, AmarasekareCoutinho, AmarasekareScranton}.  We incorporate the effects of temperature using a mechanistic, trait-based approach \citep{ALotOfLiterature} by using trait temperature response curves from the literature which are derived from first principles and are known to be well conserved across ectothermic taxa \citep{MoreLiterature}.

## Simulations

Most of the analysis done with the code of this repository was through numerical integration via the `expl-comp-sim.py` script.  The script uses python 2.7 in order to use the PyDDE library, which at the time of this writing is no longer compatible with the latest python3 build.  The purpose of this code is to run numerical integration of an explopitative competition system, with two consumers attacking the same resource species.  Our python script contains three versions of the model, one where the adult consumers attack the juvenile resource (default), one where the adult consumers attack the adult resource (-a option), and an ODE model where there is no stage structure or time delays (-u option).  Other options of the simulation file are described in the scripts docstring.  For more details on the model see Casas Goncalves and Amarasekare 202X.

A sample run of this script would look loke this

```
expl-comp-sim.py \
     -p [PARAMETER FILE] \
     -v [VARIABLES FILE] \
     -N [VARIABLE COMBINATION] \
     -o [OUTPUTPREFIX]
```

The parameter and output files are written in JSON format.  Details on their format, as well as other options for the `expl-comp-sim.py` script are given below.  We also provide a wrapper for iterated simulations to be run in parallel bash threads with the scripts `twostage.sh` and `onestage.sh`.

## Parameter Files

The fixed parameters are given in a JSON file, which contains a dictionary for all parameters used in the system.  The file greenplant-peristenus.json can be used as an example; it contains parameters for the system composed of the greenplant bug *Apolygus lucorum* and its two parasitoid wasps *Peristenus spretus* and *Peristenus relictus*.

The variable parameter JSON file describes how parmeters will be varied in a batch of simulations.  It contains inforation regarding which parameters will be varied, and whether they will be varied synchronously or independently.  Each set of parameters being varied synchronously, or axis of variation, is represented by a list of lists, where each sublist contains a string which is the parameter name, followed by the minimum and maximum values attained by that parameter, both float types.  So if we wish to create a simulation batch in which the parameters AdL1 and AdP1 from 5000.0 to 15000.0 synchronously, the file must contain the list

```
[
    ["AdL1", 5000.0, 15000.0],
    ["AdP1", 5000.0, 15000.0]
]
```

The number of steps taken in each axis of variation must be put in a single list before all axes of variation in that file, followed by a list containing all axes of variation.  For the simulations described above, if we wished to vary the parameters in steps of 1000.0, that is a total of 11 steps, so the variable parameters file would like the following

```
[
    [ 11 ],
    [
        ["AdL1", 5000.0, 15000.0],
        ["AdP1", 5000.0, 15000.0]
    ]
]
```

Adding multiple axes of variation will cause each parameter set to be varied independently, so that all combinations of parameter values are achieved.  Following the above example, say we also wish to synchrnously vary the parameter AdL2 over the range from 7000.0 to 10000.0 with a step of 500.0 and AdP2 from 5000.0 to 11000.0 with a step of 1000.0.  Notice that both ranges give a total of 7 steps, so the variable parameters file would look like the following

```
[
    [ 11, 7 ],
    [
        ["AdL1", 5000.0, 15000.0],
        ["AdP1", 5000.0, 15000.0]
    ],
    [
        ["AdL2", 7000.0, 10000.0],
        ["AdP2", 5000.0, 11000.0]
    ]
]
```

Notice that the while the number of steps must be the same for all variables in an axis, the step size can vary.

## Batch Simulations

The wrappers `twostage.sh` and `onestage.sh` can be used to conduct batch simulations of the structured and unstructured models, respectively.  In each file, change the DIR variable contains the path to the directory containing the python script and other folders, while PARFILE is the name of the file containing the fixed parameters.  The variable parameters are given through the FILELIST variable, and multiple files can be given by including their names sequentially within the parentheis.  NJOBSLIST is the number of parameter combinations in each file.  You can specify different initial conditions through INITLIST to set certai species to zero and thus exclude them from the system: setting it `inv1` sets consumer 1 as the invader and consumer 2 as the resident, and `pair1` sets consumer 2 to zero, leaving only the resource and consumer 1, while `inv2` and `pair2` do the opposite, and `res` sets both consumers to zero, leaving only the resource.
